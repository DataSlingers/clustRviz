<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>clustRviz Details • clustRviz</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">clustRviz</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/clusRvizDetails.html">clustRviz Details</a>
    </li>
    <li>
      <a href="../articles/Getting_Started.html">Getting Started</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>clustRviz Details</h1>
                        <h4 class="author">John Nagorski</h4>
            
            <h4 class="date">2018-06-29</h4>
          </div>

    
    
<div class="contents">
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>The <code>clustRviz</code> package intends to make fitting and visualizing CARP and CBASS solution paths an easy process. In the <a href="Getting_Started.html">Getting Started</a> vignettee we provide a quick start guide for basic usage, fitting, and plotting. In this vignette, we build on the basics and provide a more detailed explanation for the variety of options available in <code>clustRviz</code>.</p>
</div>
<div id="background" class="section level1">
<h1 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h1>
<p>The starting point for CARP the Convex Clustering problem.</p>
<p><span class="math display">\[
\underset{{\boldsymbol{U}}}{\textrm{minimize}} \;\;
\frac{1}{2} \| {\boldsymbol{X}} - {\boldsymbol{U}} \|_F^2 + 
\lambda \sum_{ l &lt; m} 
w_{l,m} \| {\boldsymbol{u}}_l - {\boldsymbol{u}}_m \|_2
\]</span></p>
<p>The above can be solved via ADMM</p>
<p><span class="math display">\[
\underset{{\boldsymbol{U}}, {\boldsymbol{V}}}{\text{minimize}}\;\;
\frac{1}{2} \| {\boldsymbol{X}} - {\boldsymbol{U}} \|_2^2  +  \lambda \sum_{l&lt;m} w_{l,m} \|  {\boldsymbol{v}}_{l,m} \|_2 \\
\text{subject to}\;\;\;\;\;
{\boldsymbol{u}}_{l} - {\boldsymbol{u}}_{m} = {\boldsymbol{v}}_{l,m}, \;\; \forall l,m
\]</span></p>
<p>Convex clustering is traditionally solved by iteratively applying ADMM updates until convergence.</p>
<p>This must be done for each <span class="math inline">\(\lambda_k\)</span> which is costly.</p>
</div>
<div id="preprocessing-and-inputs" class="section level1">
<h1 class="hasAnchor">
<a href="#preprocessing-and-inputs" class="anchor"></a>Preprocessing and Inputs</h1>
<p>While the <code>CARP</code> and <code>CBASS</code> functions provides several reasonable default choices for weights, algorithms, etc, it is important to know their details if one wishes to compute more customized clustering choices. Here we examine several of the inputs to <code>CARP</code> and <code>CBASS</code>, as well as their preprocessing technqiues</p>
<p>While we will still use the <code>CARP</code> and <code>CBASS</code> functions, we will also encounter serveral other package functions along the way.</p>
<p>As before, we will use the presidential speech dataset to illustrate the variety of options available. Let’s begin by loading our package and the dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(clustRviz)
<span class="kw">data</span>(<span class="st">"presidential_speech"</span>)
Xdat &lt;-<span class="st"> </span>presidential_speech
obs.labels &lt;-<span class="st"> </span><span class="kw">rownames</span>(Xdat)
var.labels &lt;-<span class="st"> </span><span class="kw">colnames</span>(Xdat)
Xdat[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]
<span class="co">#&gt;                     amount appropri  british     cent commerci</span>
<span class="co">#&gt; Abraham Lincoln   3.433987 2.397895 1.791759 2.564949 2.708050</span>
<span class="co">#&gt; Andrew Jackson    4.248495 4.663439 2.995732 1.945910 3.828641</span>
<span class="co">#&gt; Andrew Johnson    4.025352 3.091042 2.833213 3.332205 2.772589</span>
<span class="co">#&gt; Barack Obama      1.386294 0.000000 0.000000 1.386294 0.000000</span>
<span class="co">#&gt; Benjamin Harrison 4.060443 4.174387 2.302585 4.304065 3.663562</span>
<span class="kw">head</span>(obs.labels)
<span class="co">#&gt; [1] "Abraham Lincoln"   "Andrew Jackson"    "Andrew Johnson"   </span>
<span class="co">#&gt; [4] "Barack Obama"      "Benjamin Harrison" "Calvin Coolidge"</span>
<span class="kw">head</span>(var.labels)
<span class="co">#&gt; [1] "amount"     "appropri"   "british"    "cent"       "commerci"  </span>
<span class="co">#&gt; [6] "commission"</span></code></pre></div>
<p>Again our speech data consists of log-transformed word counts from speech found at url.</p>
<div id="preprocessing" class="section level2">
<h2 class="hasAnchor">
<a href="#preprocessing" class="anchor"></a>Preprocessing</h2>
<div id="normalization" class="section level3">
<h3 class="hasAnchor">
<a href="#normalization" class="anchor"></a>Normalization</h3>
<p>An important first choice before clustering is whether to center and scale our observations.</p>
<p>Centering should always be done.</p>
<p>The choice of scaling is left to the user discression, but should typically be applied if measurements are a vastly different scales.</p>
<p>In the case of the presidental speech dataset, all variables are of the same type and so we do not scale our data matrix</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Centering data before computing the CARP solution path</span>
Xdat.preprocessed &lt;-<span class="st"> </span><span class="kw">scale</span>(Xdat,<span class="dt">center=</span><span class="ot">TRUE</span>,<span class="dt">scale=</span><span class="ot">FALSE</span>)</code></pre></div>
<p>In the <code>CARP</code> function this preprocessing is done via the <code>X.center</code> and <code>X.scale</code> arguements. If the data is pre-processed outside of <code>CARP</code>, as is the case here, these options may be set to <code>FALSE</code></p>
<p>Similarly, the <code>CBASS</code> function also requires that data preprocessed prior usage. Because <code>CBASS</code> clusters both observations and variables, here centering is done by subtracting away the global mean of our data matrix.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Subtracting global mean before computing the CBASS solution path</span>
Xdat.bi &lt;-<span class="st"> </span>Xdat
Xdat.bi.preprocessed &lt;-<span class="st"> </span>Xdat <span class="op">-</span><span class="st">  </span><span class="kw">mean</span>(Xdat)</code></pre></div>
</div>
<div id="dimension-reduction" class="section level3">
<h3 class="hasAnchor">
<a href="#dimension-reduction" class="anchor"></a>Dimension Reduction</h3>
<p>While not directly addressed by <code>CARP</code> or <code>CBASS</code>, high dimensional measurements can present a challenge for clustering methods.</p>
<p>Owing to the “curse of dimensionality”, high dimensional measurements may deliver sub-optimal performance for distance-based methods generally.</p>
<p>As such, performing dimensionality reduction before applying <code>CARP</code><br>
may result in more interpretable clusters.</p>
<p>We leave the choice of dimensionality reduction to the end-user, but still recommend the reduced feature set be pre-processed as described above.</p>
<p>For the purpose of visualuization, <code>CARP</code> addresses the problem of high dimenstionality by visualizing the principal components of the data by default.</p>
</div>
</div>
<div id="weights" class="section level2">
<h2 class="hasAnchor">
<a href="#weights" class="anchor"></a>Weights</h2>
<p>Weights are arguably one of the most important inputs to both <code>CARP</code> and <code>CBASS</code>.</p>
<p>As we can see from the optimization probelms above, weights impart apriori preference concerning which observations (and variables in the case of <code>CBASS</code>) should be fused together.</p>
<p>This important feature allows us to incorportate domain knowledge, if available.</p>
<p>In the absense of domain knowledge, however, weights can easily be constructed via the data itself.</p>
<p>One might first consider simply using a set of uninformative weights, <span class="math inline">\(w_{l.m} = 1\)</span></p>
<p>While perhaps not appearent at first, such weight choices can also greatly affect the computation time of both <code>CARP</code> and <code>CBASS</code> (and certainly Convex Clustering).</p>
<p>To see this note that in the Convex Clustering problem above the regularization term contains <span class="math inline">\(\binom{n}{2}\)</span> summands, drastically increasing computations as <span class="math inline">\(n\)</span> increases.</p>
<p>Computations can be reduced by making the majority of weights zero and greatly reducing the number of summands.</p>
<p>Here we detail <code>clustRviz</code>’s default weight choices, as well as how weights can be constructed manually.</p>
<p>By default <code>CARP</code> and <code>CBASS</code> assume no prior domain knowledge and construct distance-based weights via a gaussian kernel:</p>
<p><span class="math display">\[
w_{l,m}  = \exp\{ -\phi \|{\boldsymbol{x}}_l - {\boldsymbol{x}}_m \|^2_2 \}
\]</span> Given a choice of <span class="math inline">\(\phi\)</span> (discussed in more detail below), an initial set of weights can be constructed via <code>DenseWeights</code> function. In the case of presidential speech data for example,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dense.weights &lt;-<span class="st"> </span>clustRviz<span class="op">:::</span><span class="kw"><a href="../reference/DenseWeights.html">DenseWeights</a></span>(<span class="dt">X =</span> Xdat.preprocessed,<span class="dt">phi=</span><span class="fl">1e-3</span>)
<span class="kw">head</span>(dense.weights)
<span class="co">#&gt; [1] 0.9053890 0.9676079 0.5474781 0.8777638 0.8041133 0.9350156</span></code></pre></div>
<p>As the name suggests <code>DenseWeights</code> computes <span class="math inline">\(w_{l,m}\)</span> for all pairs of observations.</p>
<p>For the presidents data, with <span class="math inline">\(n=44\)</span> observations, this results in a vector of length <span class="math inline">\(\binom{44}{2} = 956\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">length</span>(dense.weights)
<span class="co">#&gt; [1] 946</span></code></pre></div>
<p>The weights are returned in lexicographical order, namely <span class="math inline">\({\boldsymbol{w}} = (w_{1,2},w_{1,3},\dots,w_{l,m},\dots,w_{n-1,n} )\)</span></p>
<p>The value of <span class="math inline">\(\phi\)</span> can have a marked effect on the weights.</p>
<div class="figure" style="text-align: center">
<img src="clusRvizDetails_files/figure-html/unnamed-chunk-6-1.png" alt="Dense weights for different choices of phi" width="960"><p class="caption">
Dense weights for different choices of phi
</p>
</div>
<p>The choice of <span class="math inline">\(\phi\)</span> determines variance of the weights.</p>
<p>Generally, choices of <span class="math inline">\(\phi\)</span> which result in higher variance weights tend to be more informative. A simple method for finding a reasonable choice of <span class="math inline">\(\phi\)</span> is a basic grid search. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">phi.vec &lt;-<span class="st"> </span><span class="dv">10</span><span class="op">^</span>(<span class="op">-</span><span class="dv">4</span><span class="op">:</span><span class="dv">4</span>)
<span class="kw">sapply</span>(phi.vec,<span class="cf">function</span>(phi){
  <span class="kw">var</span>(clustRviz<span class="op">:::</span><span class="kw"><a href="../reference/DenseWeights.html">DenseWeights</a></span>(<span class="dt">X=</span>Xdat.preprocessed,<span class="dt">phi =</span> phi))
}) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">which.max</span>() <span class="op">%&gt;%</span>
<span class="st">  </span>phi.vec[.]
<span class="co">#&gt; [1] 0.01</span></code></pre></div>
<p>Additionally, <code>DenseWeights</code> allows for the specification of alternative distance measures</p>
<p>Depending on the dataset, alternative metrics to traditional euclidean distance may result in more informative clustering solutions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dense.weights.can &lt;-<span class="st"> </span>clustRviz<span class="op">:::</span><span class="kw"><a href="../reference/DenseWeights.html">DenseWeights</a></span>(<span class="dt">X =</span> Xdat.preprocessed,<span class="dt">phi=</span><span class="fl">1e-5</span>,<span class="dt">method =</span> <span class="st">'canberra'</span>)</code></pre></div>
<div class="figure" style="text-align: center">
<img src="clusRvizDetails_files/figure-html/unnamed-chunk-9-1.png" alt="Dense weights with Canberra distance" width="672"><p class="caption">
Dense weights with Canberra distance
</p>
</div>
<p>Distance-based weights can be made sparse by only fusing together nearest neighbors.</p>
<p>For a given observations <span class="math inline">\(l\)</span> we consider its <span class="math inline">\(k\)</span> nearest neighbors <span class="math inline">\(\textrm{ne}_k(l)\)</span>.</p>
<p>Given a pair of observations <span class="math inline">\(l,m\)</span>, we set their corresponding weight, <span class="math inline">\(w_{l,m}\)</span>, to zero if either is not amongst the other nearest neighbors. Specifically,</p>
<p><span class="math display">\[
\tilde{w}_{l,m} = w_{l,m} {\boldsymbol{1}}_{\textrm{ne}_k(l)}(m) {\boldsymbol{1}}_{\textrm{ne}_k(m)}(l)
\]</span> where <span class="math inline">\(w_{l,m}\)</span> is our original dense weight values and <span class="math inline">\({\boldsymbol{1}}_{A}(x)\)</span> denotes the indicator function of the set <span class="math inline">\(A\)</span>.</p>
<p>For a specifid value of <span class="math inline">\(k\)</span>, a sparse vector of <span class="math inline">\(k\)</span> nearest neighbor weights can be generated via the <code>SparseWeights</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">k.neighbors &lt;-<span class="st"> </span><span class="dv">5</span>
clustRviz<span class="op">:::</span><span class="kw"><a href="../reference/SparseWeights.html">SparseWeights</a></span>(
  <span class="dt">X=</span>Xdat.preprocessed,
  <span class="dt">dense.weights =</span> dense.weights,
  <span class="dt">k =</span> k.neighbors) -&gt;<span class="st"> </span>sparse.weights</code></pre></div>
<p>In the case of <span class="math inline">\(k=\)</span> 5 above, the number of non-zero weight values (and hence the number of summands in our original objective) has been reduced from <span class="math inline">\(\binom{44}{2} = 956\)</span> to</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sum</span>(sparse.weights<span class="op">!=</span><span class="dv">0</span>)
<span class="co">#&gt; [1] 144</span></code></pre></div>
<p>Computationally, it is tempting to set <span class="math inline">\(k\)</span> small and ensure fast compuatation.</p>
<p>Setting <span class="math inline">\(k\)</span> too small, however, can potentially prevent observations from fusing, regardless of the amount of regularization.</p>
<p>In order to verify that our sparse set of weights allows for the eventual fusion of all observations we can examine its graphical representation.</p>
<p>The function <code>PlotWeightGraph</code> displays the fusion graph of our observations induced by the support of our weight set.</p>
<p>The fusion graph displays each observation as a vertex, and connects two observation with an edge if their corresponding weight is non-zero.</p>
<p>Such connections between observations indicate their ability fuse into a common cluster, given large enough regularization.</p>
<p>Below we consider the extreme case of <span class="math inline">\(k=1\)</span>, which while computationally fast presents an immediate difficulty.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clustRviz<span class="op">:::</span><span class="kw"><a href="../reference/PlotWeightGraph.html">PlotWeightGraph</a></span>(
  <span class="dt">weights =</span> clustRviz<span class="op">:::</span><span class="kw"><a href="../reference/SparseWeights.html">SparseWeights</a></span>(
    <span class="dt">X=</span>Xdat.preprocessed,
    <span class="dt">dense.weights =</span> dense.weights,
    <span class="dt">k=</span><span class="dv">1</span>
  ),
  <span class="dt">nobs =</span> <span class="kw">nrow</span>(Xdat.preprocessed),
  <span class="dt">edge.labels =</span> <span class="ot">TRUE</span>,
  <span class="dt">obs.labels =</span> obs.labels,
  <span class="dt">vsize=</span><span class="dv">3</span>,
  <span class="dt">label.scale=</span><span class="ot">FALSE</span>,
  <span class="dt">label.cex=</span>.<span class="dv">7</span>,
  <span class="dt">repulsion=</span>.<span class="dv">9</span>)</code></pre></div>
<p><img src="clusRvizDetails_files/figure-html/unnamed-chunk-12-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Examining the graph above, we note that the number of connected components is strictly greater than one. As such, regardless of the number of <code>CARP</code> iteratations (and the associated regularization increases) it will not be possible fuse all observations into a single cluster. Such extreme weight choices should typically be avoided as they not only hinder the agglomorative nature of <code>CARP</code> and <code>CBASS</code>, but also lead to biased and less interpretable solution paths. result in.</p>
<p>At the other extreme, large values of <span class="math inline">\(k\)</span> again result in long computation time and bring little to no improvement on the resulting solution sequence; an example of such an overly dense graph can be seen below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clustRviz<span class="op">:::</span><span class="kw"><a href="../reference/PlotWeightGraph.html">PlotWeightGraph</a></span>(
  <span class="dt">weights =</span> clustRviz<span class="op">:::</span><span class="kw"><a href="../reference/SparseWeights.html">SparseWeights</a></span>(
    <span class="dt">X=</span>Xdat.preprocessed,
    <span class="dt">dense.weights =</span> dense.weights,
    <span class="dt">k=</span><span class="dv">15</span>
  ),
  <span class="dt">nobs =</span> <span class="kw">nrow</span>(Xdat.preprocessed),
  <span class="dt">edge.labels =</span> <span class="ot">FALSE</span>,
  <span class="dt">obs.labels =</span> obs.labels,
  <span class="dt">vsize=</span><span class="dv">3</span>,
  <span class="dt">label.scale=</span><span class="ot">FALSE</span>,
  <span class="dt">label.cex=</span>.<span class="dv">7</span>,
  <span class="dt">repulsion=</span>.<span class="dv">9</span>)</code></pre></div>
<p><img src="clusRvizDetails_files/figure-html/unnamed-chunk-13-1.png" width="480" style="display: block; margin: auto;"></p>
<p>In order to provide a reasonable choice regarding weight sparsity, the function <code>MinKNN</code> may be used to find a balance between computational efficiency and poor clustering performance. <code>MinKNN</code> takes as its arguement an initial set of dense weights and returns the smallest <span class="math inline">\(k\)</span> such the graph induced by the support of the resulting set of sparse weights contains exactly one connected component. For our current vector of weights we have:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clustRviz<span class="op">:::</span><span class="kw"><a href="../reference/MinKNN.html">MinKNN</a></span>(
  <span class="dt">X =</span> Xdat.preprocessed,
  <span class="dt">dense.weights =</span> dense.weights
) -&gt;<span class="st"> </span>k.min
k.min
<span class="co">#&gt; [1] 4</span></code></pre></div>
<p>Using the <code>k.min</code> value above we may compute the corresponding sparse weight vector and view its resulting graph below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clustRviz<span class="op">:::</span><span class="kw"><a href="../reference/SparseWeights.html">SparseWeights</a></span>(
  <span class="dt">X =</span> Xdat.preprocessed,
  <span class="dt">dense.weights =</span> dense.weights,
  <span class="dt">k =</span> k.min
) -&gt;<span class="st"> </span>sparse.weights</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clustRviz<span class="op">:::</span><span class="kw"><a href="../reference/PlotWeightGraph.html">PlotWeightGraph</a></span>(
  <span class="dt">weights =</span> sparse.weights,
  <span class="dt">nobs =</span> <span class="kw">nrow</span>(Xdat.preprocessed),
  <span class="dt">edge.labels =</span> <span class="ot">FALSE</span>,
  <span class="dt">obs.labels =</span> obs.labels,
  <span class="dt">vsize=</span><span class="dv">3</span>,
  <span class="dt">label.scale=</span><span class="ot">FALSE</span>,
  <span class="dt">label.cex=</span>.<span class="dv">7</span>,
  <span class="dt">repulsion=</span>.<span class="dv">9</span>)</code></pre></div>
<p><img src="clusRvizDetails_files/figure-html/unnamed-chunk-16-1.png" width="480" style="display: block; margin: auto;"></p>
<p>We can see that the resulting graph offers a compromise between the two extremes. By default both <code>CARP</code> and <code>CBASS</code> use the value returned by <code>MinKNN</code> to produce sparse sets of weights. While slightly larger values of <span class="math inline">\(k\)</span> can be used, it is not recommended to pass below this threshold for the reasons stated above.</p>
</div>
</div>
<div id="fitting" class="section level1">
<h1 class="hasAnchor">
<a href="#fitting" class="anchor"></a>Fitting</h1>
<p><code>clustRviz</code> aims to make it easy to compute the CARP and CBASS solution paths, and to quickly begin exploring the results. To this end, many reasonable choices regarding both preprocessing and inputs disucussed above are made by default, allowing for solution path to be computed from the raw data alone. In the case of CARP, for example, we may fit the compute the solution path for the presidents data via the <code>CARP</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/CARP.html">CARP</a></span>(
  <span class="dt">X=</span>Xdat,
  <span class="dt">obs.labels =</span> obs.labels
) -&gt;<span class="st"> </span>carp.fit</code></pre></div>
<p>Once completed, we can examine a brief summary of the fitted object</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(carp.fit)
<span class="co">#&gt; CARP Fit Summary</span>
<span class="co">#&gt; Number of Observations: 44</span>
<span class="co">#&gt; Number of Variables: 75</span>
<span class="co">#&gt; Pre-processing: center</span>
<span class="co">#&gt; Weights: RBF Kernel, phi = 0.001, k = 4</span>
<span class="co">#&gt; Algorithm: CARP-VIZ</span>
<span class="co">#&gt; Visualizations: Static DendStatic PathInteractive Dend/Path</span>
<span class="co">#&gt; Raw Data:</span>
<span class="co">#&gt;                     amount appropri  british     cent commerci</span>
<span class="co">#&gt; Abraham Lincoln   3.433987 2.397895 1.791759 2.564949 2.708050</span>
<span class="co">#&gt; Andrew Jackson    4.248495 4.663439 2.995732 1.945910 3.828641</span>
<span class="co">#&gt; Andrew Johnson    4.025352 3.091042 2.833213 3.332205 2.772589</span>
<span class="co">#&gt; Barack Obama      1.386294 0.000000 0.000000 1.386294 0.000000</span>
<span class="co">#&gt; Benjamin Harrison 4.060443 4.174387 2.302585 4.304065 3.663562</span></code></pre></div>
<p>The output above displays characteristics of our data, such as sample size and number of variables, and also gives a preview of the raw input. Additionally, the summary provides information regarding both data pre-processing and weight computations. From the above we see that <code>CARP</code> has by default: (i) centered our data, (ii) computed distance-based weights using a gaussian kernel with <span class="math inline">\(\phi=.001\)</span>, and (iii) created a sparse set of weights using <span class="math inline">\(k=4\)</span> nearest neighbors. Finally, the summary also provides information about the algorithm, here CARP-VIZ, as well as the available visualizations.</p>
<p>While <code>CARP</code>’s default choices work well in most scenarios, customized inputs can also be provided. For example, choices regrarding preprocessing and weight computations discussed above can quickly be incorporated:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/CARP.html">CARP</a></span>(
  <span class="dt">X=</span>Xdat,
  <span class="dt">obs.labels =</span> obs.labels,
  <span class="dt">X.center=</span><span class="ot">TRUE</span>,
  <span class="dt">X.scale=</span><span class="ot">TRUE</span>,
  <span class="dt">phi =</span> <span class="fl">1e-5</span>,
  <span class="dt">weight.dist =</span> <span class="st">'canberra'</span>,
  <span class="dt">k =</span> <span class="dv">5</span>
) -&gt;<span class="st"> </span>carp.fit.custom</code></pre></div>
<p>Indeed, in the case strong apriori information concerning clusters is available, distance-based weight computations may be avoided altogether and user-specified weights given directly via the <code>weights</code> arguement.</p>
<p><code>CBASS</code> solutions can be fit in a similar manner:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/CBASS.html">CBASS</a></span>(
  <span class="dt">X=</span>Xdat,
  <span class="dt">obs.labels =</span> obs.labels,
  <span class="dt">var.labels =</span> var.labels
) -&gt;<span class="st"> </span>cbass.fit</code></pre></div>
<p>And display its output:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cbass.fit
<span class="co">#&gt;                     amount appropri  british     cent commerci</span>
<span class="co">#&gt; Abraham Lincoln   3.433987 2.397895 1.791759 2.564949 2.708050</span>
<span class="co">#&gt; Andrew Jackson    4.248495 4.663439 2.995732 1.945910 3.828641</span>
<span class="co">#&gt; Andrew Johnson    4.025352 3.091042 2.833213 3.332205 2.772589</span>
<span class="co">#&gt; Barack Obama      1.386294 0.000000 0.000000 1.386294 0.000000</span>
<span class="co">#&gt; Benjamin Harrison 4.060443 4.174387 2.302585 4.304065 3.663562</span></code></pre></div>
</div>
<div id="solutions" class="section level1">
<h1 class="hasAnchor">
<a href="#solutions" class="anchor"></a>Solutions</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">carp.clustering &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Clustering.html">Clustering</a></span>(carp.fit,<span class="dt">k =</span> <span class="dv">2</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(carp.clustering<span class="op">$</span>clustering.assignment)
<span class="co">#&gt; </span>
<span class="co">#&gt; cl1 cl2 </span>
<span class="co">#&gt;  30  14</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clustRviz<span class="op">:::</span><span class="kw"><a href="../reference/PlotWeightGraph.html">PlotWeightGraph</a></span>(
  <span class="dt">weights =</span> sparse.weights,
  <span class="dt">nobs =</span> <span class="kw">nrow</span>(Xdat.preprocessed),
  <span class="dt">edge.labels =</span> <span class="ot">FALSE</span>,
  <span class="dt">obs.labels =</span> obs.labels,
  <span class="dt">vsize=</span><span class="dv">3</span>,
  <span class="dt">color=</span><span class="kw">rainbow</span>(<span class="dv">2</span>)[<span class="kw">as.numeric</span>(<span class="kw">str_extract</span>(carp.clustering<span class="op">$</span>clustering.assignment,<span class="st">"(</span><span class="ch">\\</span><span class="st">d)+"</span>))],
  <span class="dt">label.scale=</span><span class="ot">FALSE</span>,
  <span class="dt">label.cex=</span>.<span class="dv">7</span>,
  <span class="dt">repulsion=</span>.<span class="dv">9</span>)</code></pre></div>
<p><img src="clusRvizDetails_files/figure-html/unnamed-chunk-24-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(carp.clustering<span class="op">$</span>cluster.means)
<span class="co">#&gt;           cl1       cl2</span>
<span class="co">#&gt; [1,] 3.247043 1.8627224</span>
<span class="co">#&gt; [2,] 3.226682 2.0425014</span>
<span class="co">#&gt; [3,] 2.312455 0.5157932</span>
<span class="co">#&gt; [4,] 2.055121 0.7925161</span>
<span class="co">#&gt; [5,] 2.743924 0.9780746</span>
<span class="co">#&gt; [6,] 2.380273 0.1980421</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">carp.clustering &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Clustering.html">Clustering</a></span>(carp.fit,<span class="dt">percent =</span> .<span class="dv">25</span>)

clustRviz<span class="op">:::</span><span class="kw"><a href="../reference/PlotWeightGraph.html">PlotWeightGraph</a></span>(
  <span class="dt">weights =</span> sparse.weights,
  <span class="dt">nobs =</span> <span class="kw">nrow</span>(Xdat.preprocessed),
  <span class="dt">edge.labels =</span> <span class="ot">FALSE</span>,
  <span class="dt">obs.labels =</span> obs.labels,
  <span class="dt">vsize=</span><span class="dv">3</span>,
  <span class="dt">color=</span><span class="kw">rainbow</span>(<span class="kw">ncol</span>(carp.clustering<span class="op">$</span>cluster.means))[
    <span class="kw">as.numeric</span>(<span class="kw">str_extract</span>(carp.clustering<span class="op">$</span>clustering.assignment,<span class="st">"(</span><span class="ch">\\</span><span class="st">d)+"</span>))
    ],
  <span class="dt">label.scale=</span><span class="ot">FALSE</span>,
  <span class="dt">label.cex=</span>.<span class="dv">7</span>,
  <span class="dt">repulsion=</span>.<span class="dv">9</span>)</code></pre></div>
<p><img src="clusRvizDetails_files/figure-html/unnamed-chunk-26-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cbass.clustering &lt;-<span class="st"> </span><span class="kw"><a href="../reference/Clustering.html">Clustering</a></span>(cbass.fit,<span class="dt">percent =</span> .<span class="dv">8</span>)</code></pre></div>
</div>
<div id="visualizations" class="section level1">
<h1 class="hasAnchor">
<a href="#visualizations" class="anchor"></a>Visualizations</h1>
<div id="static" class="section level2">
<h2 class="hasAnchor">
<a href="#static" class="anchor"></a>Static</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(carp.fit,<span class="dt">type =</span> <span class="st">'path'</span>,<span class="dt">percent=</span>.<span class="dv">5</span>)</code></pre></div>
<p><img src="clusRvizDetails_files/figure-html/unnamed-chunk-28-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(carp.fit,<span class="dt">type =</span> <span class="st">'dendrogram'</span>)</code></pre></div>
<p><img src="clusRvizDetails_files/figure-html/unnamed-chunk-29-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="dynamic" class="section level2">
<h2 class="hasAnchor">
<a href="#dynamic" class="anchor"></a>Dynamic</h2>
<iframe src="https://clustrviz.shinyapps.io/PathShiny/" width="100%" height="850px">
</iframe>
</div>
<div id="saving" class="section level2">
<h2 class="hasAnchor">
<a href="#saving" class="anchor"></a>Saving</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/saveviz.html">saveviz</a></span>(
  carp.fit,
  <span class="dt">file.name =</span> <span class="st">'path_dyn.gif'</span>,
  <span class="dt">plot.type =</span> <span class="st">'path'</span>,
  <span class="dt">image.type =</span> <span class="st">'dynamic'</span>
)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/saveviz.html">saveviz</a></span>(
  carp.fit,
  <span class="dt">file.name =</span> <span class="st">'carp_dend_static.png'</span>,
  <span class="dt">plot.type =</span> <span class="st">'dendrogram'</span>,
  <span class="dt">image.type =</span> <span class="st">'static'</span>
)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/saveviz.html">saveviz</a></span>(
  cbass.fit,
  <span class="dt">file.name =</span> <span class="st">'cbass_heat_dyn.gif'</span>,
  <span class="dt">plot.type =</span> <span class="st">'heatmap'</span>,
  <span class="dt">image.type =</span> <span class="st">'dynamic'</span>
)</code></pre></div>
</div>
</div>
<div id="discussion" class="section level1">
<h1 class="hasAnchor">
<a href="#discussion" class="anchor"></a>Discussion</h1>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#background">Background</a></li>
      <li>
<a href="#preprocessing-and-inputs">Preprocessing and Inputs</a><ul class="nav nav-pills nav-stacked">
<li><a href="#preprocessing">Preprocessing</a></li>
      <li><a href="#weights">Weights</a></li>
      </ul>
</li>
      <li><a href="#fitting">Fitting</a></li>
      <li><a href="#solutions">Solutions</a></li>
      <li>
<a href="#visualizations">Visualizations</a><ul class="nav nav-pills nav-stacked">
<li><a href="#static">Static</a></li>
      <li><a href="#dynamic">Dynamic</a></li>
      <li><a href="#saving">Saving</a></li>
      </ul>
</li>
      <li><a href="#discussion">Discussion</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by John Nagorski.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
